# Dockerfile optimizado para producción (Coolify)
FROM node:20-alpine AS builder

WORKDIR /app

# Copiar package files
COPY package.json package-lock.json* ./
RUN npm install --legacy-peer-deps

# Copiar código fuente
COPY . .

# Build args para configurar API URL en build time
ARG VITE_API_URL=/api
ENV VITE_API_URL=$VITE_API_URL

# Build de producción
RUN npm run build

# Imagen final con Caddy
FROM caddy:alpine

# Copiar build
COPY --from=builder /app/dist /usr/share/caddy

# Copiar Caddyfile
COPY Caddyfile /etc/caddy/Caddyfile

EXPOSE 80
